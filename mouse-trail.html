<!DOCTYPE html>

<html>
  <head>
    <title>Mouse Trail</title>
    <meta charset="utf-8" />

    <style>
      #trail {
        position: absolute;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: red;
      }
    </style>
  </head>

  <body>
    <div id="trail"></div>

    <script>
      "use strict";

      const trail = createMouseTrailObjectById("trail");
      trail.start();

      function createMouseTrailObjectById(id) {
        const trail = document.getElementById(id);
        const trailItems = [];

        function start() {
          checkTrailElementExists();
          createTrailElementsByTrailSize();
          addMouseMoveEventListener();
        }

        function checkTrailElementExists() {
          if (!trail) {
            throw new Error(`Trail element '#${id}' was not found.`);
          }
        }

        function createTrailElementsByTrailSize() {
          const trailSize = 10;

          trailItems.push(trail);

          for (let i = 0; i < trailSize; i++) {
            const trailClone = trail.cloneNode();
            trail.insertAdjacentElement("afterend", trailClone);

            trailItems.push(trailClone);
          }
        }

        function addMouseMoveEventListener() {
          window.addEventListener("mousemove", (e) => {
            window.requestAnimationFrame(() =>
              moveTrailToPosition(e.clientY, e.clientX)
            );
          });
        }

        function moveTrailToPosition(top = 0, left = 0) {
          const initialDelayInMs = 20;
          const delayToAddToNextTrailElement = 30;
          const topMargin = 20;
          const lefMargin = 5;

          let delay = initialDelayInMs;

          trailItems.forEach((item) => {
            setTimeout(() => {
              item.style.top = `${top + topMargin}px`;
              item.style.left = `${left + lefMargin}px`;
            }, delay);

            delay += delayToAddToNextTrailElement;
          });
        }

        return {
          start,
        };
      }
    </script>
  </body>
</html>
